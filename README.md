# Bear AI Developer Application

"Bear AI 개발자"라고 명명한 이 프로젝트는 Claude Code CLI를 기반으로 Spec-driven 소프트웨어 개발을 지원하는 도구입니다. 이 애플리케이션은 Rust로 작성되었으며, Devcontainer로 개발 환경을 일관되게 구축할 수 있고, 또 Docker를 사용하여 쉽게 배포할 수 있습니다.

## Requirements
- Claude Code CLI가 설치되어 있고 해당 경로가 `$PATH`에 설정되어 있어야 합니다.
- `ANTHROPIC_API_KEY` 환경 변수에 유효한 Anthropic API 키가 설정되어 있어야 합니다.

## Features
- 개발 계획 수립
- 코드 작성 및 수정
- 코드 리뷰
- 테스트 케이스 생성
- 문서화 지원

## Instructions

### Build
```bash
cd $WORKSPACE_ROOT_DIR
make build
```

## Run
```bash
cd $WORKSPACE_ROOT_DIR
make run
```

### Test
```bash
cd $WORKSPACE_ROOT_DIR
make test
```

### Cleanup
```bash
cd $WORKSPACE_ROOT_DIR
make clean
```

## Operation flow
Bear AI 개발자 애플리케이션은 다음과 같은 주요 개발 플로우를 지원합니다:

1. 요구사항 수집
2. 스펙 문서 작성
3. 개발 계획 수립
4. 코드 작성
5. 코드 리뷰
6. 사용자 승인
7. 문서화

### 요구사항 수집
- 사용자는 TUI를 통해 요구사항을 입력할 수 있습니다. 
- 입력된 요구사항은 Claude Code CLI를 통해 분석되고, 명확한 스펙 작성을 위해 추가 질문이 이루어집니다.
- 사용자는 추가 질문에 답변을 제공하여 요구사항을 구체화합니다.
- 추가 질문 과정은 AI 모델이 더 이상 질문이 필요하지 않다고 판단할 때까지 반복됩니다.

### 스펙 문서 작성
- 요구사항 수집이 완료되면 **스펙 에이전트**가 드래프트 스펙 문서를 작성하여 사용자에게 제공합니다.
- 사용자는 드래프트 스펙에 피드백을 제공하고, 필요시 수정 요청을 할 수 있습니다.
- 피드백 및 수정 과정은 사용자가 스펙에 만족할 때까지 반복됩니다.
- 최종 승인된 스펙은 개발 계획 수립 단계로 넘어갑니다.

### 개발 계획 수립
- 승인된 스펙을 바탕으로 **플랜 에이전트**가 드래프트 개발 계획 문서를 작성하여 사용자에게 제공합니다.
- 사용자는 개발 계획에 피드백을 제공하고, 필요시 수정 요청을 할 수 있습니다.
- 피드백 및 수정 과정은 사용자가 개발 계획에 만족할 때까지 반복됩니다.
- 개발 계획 문서에 명시된 개별 작업 항목들은 AI 에이전트가 병렬로 처리할 수 있도록 분할됩니다.
- 만약 작업 항목 간에 상호 의존성이 있는 경우, 개발 계획에는 DAG (Directed Acyclic Graph)를 인접 리스트(adjacency list) 형태로 표현하여 작업 순서가 명시됩니다.
- 최종 승인된 개발 계획은 코드 작성 단계로 넘어갑니다.

## 코드 작성
- 승인된 개발 계획에 따라 n개의 **코딩 에이전트**가 멀티스레드로 실행 되어서 병렬로 코드를 작성합니다.
- 개발 계획에 명시된 개별 작업 항목마다 별도의 에이전트가 할당됩니다. 에이전트는 각 작업 항목에 대해 독립적으로 코드를 생성합니다.
- 작업 간에 상호 의존성이 있는 경우, 개발 계획에 명시된 DAG를 참고하여 의존성 순서에 따라 작업을 수행합니다. 의존성이 걸린 작업들은 선행 작업의 세션 내용을 핸드오프 문서로 만들어서 후속 작업 에이전트에게 전달합니다.
- 각 에이전트는 Claude Code CLI를 사용하여 코드를 작성합니다.

## 코드 리뷰
- 작성된 코드는 **리뷰 에이전트**가 검토합니다. 리뷰 에이전트는 코딩 에이전트가 실행된 동일한 스레드에서 병렬로 동작합니다. 
- 리뷰 에이전트는 코드의 품질, 스타일, 기능적 요구사항 충족 여부 등을 점검하고, 필요한 경우 코딩 에이전트에게 수정 요청을 보냅니다.
- 코딩 에이전트는 리뷰 에이전트의 피드백을 반영하여 코드를 수정하고, 수정된 코드는 다시 리뷰 에이전트가 검토합니다.
- 이 과정은 코드가 모든 리뷰 기준을 충족할 때까지 반복됩니다.

## 사용자 승인
- 개발 계획에 포함된 모든 작업들이 완료되고 코드 리뷰가 통과되면, 최종적으로 사용자의 승인을 받습니다.
- 사용자는 최종 코드를 검토하고, 승인 또는 추가 수정을 요청할 수 있습니다.
- 사용자가 추가 수정을 요청하는 경우, 해당 요청은 다시 코딩 에이전트에게 전달되어 수정 작업이 이루어집니다. 수정된 코드는 다시 리뷰 에이전트가 검토하며, 이 과정은 사용자가 승인을 할 때까지 반복됩니다.
- 사용자가 승인을 하면 개발 프로세스가 완료됩니다.

## 문서화
- 위 과정에서 각각의 에이전트는 자신의 작업 내용을 문서로 작성하여 기록합니다.
- 이 문서들은 프로젝트의 최종 산출물과 함께 제공되어, 향후 유지보수 및 참조에 활용될 수 있습니다.

---

# Mandatory Rules for AI assistants

- 사용자의 질문에 응답할 때는 항상 한국어로 답변한다.
- 코드 작성 및 수정 시 프로젝트의 기존 코딩 컨벤션을 따라야 한다.
- 코드 자체만으로도 무엇을 하는지 자명하게 설명되는 경우에는 불필요한 주석을 달지 않아야 한다.

  ```rust
  // 잘못된 예시

  let count = items.len(); // 아이템의 개수를 셈
  ```

- 코드만 봐서는 무엇을 하는지 금방 알기 어려운 경우는 반드시 주석을 달아야 한다.

  ```rust
  // 올바른 예시

  // LLM 응답을 다음번 요청에 추가.
  self.request
      .append_message(response.choices[0].message.clone())
      .map_err(|err| EmailAnalyzerError::InvalidRequest(err.to_string()))?;
  ```

- 코드 가독성이 제일 중요하다. 코드의 성능 또는 관용적 언어 표현 등은 가독성이 확보된 다음에 생각할 문제이다. 만약 syntactic sugar를 사용해서 한 줄로 줄인 코드보다, 여러 줄로 풀어서 쓴 것이 더 이해하기 쉽다면 반드시 후자를 선택해야 한다.
- 네이밍은 길이에 집착해서 줄임말을 쓰지 말고, 길어도 상관 없으니 긴 이름을 그대로 사용해서 가독성을 높여야 한다. 단, `db`처럼 누구나 알 수 있는 줄임말이나, 루프 인덱스에서 `i` 또는 `j` 같이 널리 사용되는 이름을 사용하는 것은 가능하다.
- 블럭, 조건문, 반복문 등으로 들여쓰기가 세 번 이상 중첩되는 경우 즉시 코드 구조를 리팩토링 해야한다. 단, 여기서 말하는 들여쓰기 "세 번"이 매직 넘버가 아님에 주의한다. 경우에 따라서는 단 한 번만 들여쓰더라도 가독성이 좋지 않을 수 있으니 케이스 바이 케이스로 적절하게 대응한다.
- 모든 함수는 오직 한 가지 일만 수행하는 단일 책임 원칙을 지켜야한다. 단, 애초에 함수의 용도가 여러 컴포넌트를 조합해서 오케스트레이션 하는 경우는 제외한다.
- 함수 또는 메소드의 길이가 50줄이 넘어가면 리팩토링을 고려하고, 100줄이 넘어가면 높은 확률로 여러 역할이 섞여있을 가능성이 크기 때문에 리팩토링을 시도해야 한다.
- 큰 변경사항은 여러 개의 작은 작업으로 분할해서 독립적으로 처리해야 한다.
- 수정사항과 관련 없는 파일은 불필요하게 건드리지 말아야 한다.
- 새로운 타입부터 만드는걸 선호하지 말고, 기존 코드의 타입으로 처리할 수는 없는지 먼저 확인해야 한다.
- 기존 어플리케이션 구조를 수정하는 것을 피하지 말아야 한다. 이미 눈이 두 개 달려있는데 옆에다가 세 번째 눈을 추가로 달아서 쉽게 가려고 하지 말고, 기존 눈의 구조를 수정해서 두 눈만으로도 할 수 있도록 만들어야 한다.